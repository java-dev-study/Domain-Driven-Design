# 2. 아키텍처 개요 
## 2.1 네 개의 영역
#### 표현영역 
사용자의 요청을 응용영역이 필요로 하는 형식으로 변환해서 응용영역에 전달하고 응용영역의 응답을 변환하여 전달한다. 
#### 응용영역 
표현영역에서 요청을 전달 받아 사용자에게 제공해야할 기능을 도메인모델을 사용해 구현한다. 
응용서비스는 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다. 
#### 도메인 영역
도메인의 핵심 로직을 구현한다.
#### 인프라스트럭처 영역
실제 구현 기술에 대한 것을 다룬다. 

## 2.2 계층 구조 아키텍쳐 
### 표현 -> (응용 -> 도메인) -> 인프라스트럭처 
- 도메인 복잡도에 따라 응용 과 도메인을 분리하기도 하고 한 계층으로 합치기도 한다. 
- 표현, 응용, 도메인 계층은 상세 기술을 다루는 인프라스트럭처 계층에 종속된다. 
- 구현의 필요성에 따라 응용계층에서 도메인 계층을 거치지 않고 인프라스트럭처 계층에 의존하기도 한다. 

## 2.3 DIP
#### 고수준 모듈 : 어떤 의미 있는 단일 기능을 제공하는 모듈 
####  저수준 모듈 : 고수준 모듈의 기능을 구현하기 하위 기능을 실제 구현한 것 
- 고수준 모듈이 저수준 모듈을 사용하면 구현변경과 테스트가 어렵다는 문제가 발생한다. 
- DIP 는 이 문제를 해결하기 위해 저수준 모듈이 고수준 모듈에 의존하도록 추상화 인터페이스를 사용한다.
- DIP를 적용하면 고수준 모듈이 저수준 모듈을 사용하려면 고수준 모듈이 저수준 모듈에 의존해야 하는데, 반대로 저수준 모듈이 고수준 모듈에 의존하게 된다. 
- DIP를 적용하면 구현 교체가 어렵다는 것과 테스트가 어려운 문제를 해소 할 수 있다.
- 실제 구현 클래스가 없어도 테스트 목적의 대역을 사용하여 테스트 할 수 있다. 
- 고수준 모듈이 저수준 모듈에 의존하지 않도록 하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출한다. 

## 2.4 도메인 영역의 주요 구성요소 
#### 엔티티와 밸류
도메인 모델의 엔티티와 DB 모델의 엔티티는 같지 않다. 
도메인 모델의 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다. 
도메인 모델의 엔티티는 데이터 구조라기보다는 데이터와 함께 기능을 제공하는 객체이다. 
두 개 이상의 데이터가 내념적으로 하나인 경우 밸류 타입을 이용해서 표현할 수 있다. 
#### 애그리거트 
애그리거트는 객체를 하나로 묶은 군집 
주문이라는 도메인의 개념은 주문, 배송지 정보, 주문자 , 주문목록, 총 결제 금액 의 하위 모델로 구성된다. 
애그리거트는 군집에 속한 객체를 관리하는 루트 엔티티를 갖는다. 
#### 리포지터리 
도메인 객체를 지속적으로 사용하기 위한 객체 보관소 
리포지터리 인터페이스는 도메인 모델 영역에 속하고, 실제 구현 클래스는 인프라스트럭처 영역에 속한다. 


## 2.5 요청처리흐름 
#### 표현 영역 -> 사용자가 전송한 데이터 형식이 올바른지 검사하고 문제가 없다면 데이터를 이훃해 응용서비스에 기능 실행을 위임
#### 응용서비스 -> 도메인 모델을 이용해 기능을 구현, 기능 구현에 필요한 도메인 객체를 리포지터리에서 가져와 실행 하거나 신규 도메인 객체를 생성해서 리포지터리에 저장  


## 2.6 인프라스트럭처 개요 
- 표현 응용 도메인 영역을 지원 
- 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조기능을 지원 
- 도메인과 응용서비스 영역에서 정의한 인터페이스를 인프라 스트럭처 영역에서 구현하는 것이 시스템을 더 유연하고, 테스트하기 쉽게 만든다. 
- 구현의 편리함은 DIP가 주는 장점만큼 중요하기 때문에 DIP의 장점을 해치지 않는 범위에서 응용영역과 도메인영역에서 구현 기술에 대한 의존을 가져가는 것은 나쁘지 않다. 

## 2.7 모듈 구성 
- 도메인 모듈은 도메인에 속한 애그리거트를 기준으로 다시 패키지를 구성한다. (한 패키지에 10~15개 미만으로 타입 갯수를 유지 노력)
- 애그리거트, 모델, 리포지터리는 같은 패키지에 위치 시킨다. 
- 도메인이 복잡하면 도메인 모델과 도메인 서비스를 별도 패키지에 위치 시킬 수도 있다.