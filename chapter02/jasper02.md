## 2.1 네개의 영역

- '표현', '응용', '도메인', '인프라스트럭처'는 아키텍처를 설계할 때 출현하는 전형적인 네 가지 영역이다.
- 표현 영역
    - 스프링 MVC 프레임워크가 표현 영역을 위한 기술에 해당
    - JSON 형식 <-> 자바 객체 타입 변환 
- 응용 영역
    - 시스템이 사용자에게 제공해야 할 기능을 구현
    - 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용
    - 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임
- 도메인 영역
    - 도메인 모델을 구현
    - 도메인의 핵심 로직을 구현
- 인프라스트럭처 영역
    - 구현 기술에 대한 것을 다룸
    - ex) DB 접근 기술, 메세징 큐에 메시지 전송 및 수신, 외부 통신 등등
    - 논리적인 개념을 표현하기보다는 실제 구현을 다룸
- 도메인, 응용, 표현 영역은 구현 기술을 사용한 코드를 직접 만들지 않고, 인프라스트럭처 영역에서 제공하는 기능을 사용해서 필요한 기능을 개발

## 2.2 계층 구조 아키텍처

- 계층 구조는 그 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다
- 계층 구조를 엄격하게 적용한다면 상위 계층은 바로 아래의 계층에만 의존을 가져야 하지만 구현의 편리함을 위해 계층 구조를 유연하게 적용하기도 한다
    - 응용 계층은 바로 아래 계층인 도메인 계층에 의존하지만 외부 시스템과의 연동을 위해 더 아래 계층인 인프라스트럭처 계층에 의존하기도 한다
- 표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭처 계층에 종속 될 수 있다
    - 인프라스트럭처에 의존하면 '테스트 어려움'과 '기능 확장의 어려움'이라는 두 가지 문제가 발생한다
    - 이런 문제들을 DIP를 적용해 해결할 수 있다

## 2.3 DIP

- 고수준 모듈은 의미 있는 단일 기능을 제공하는 모듈
- 고수준 모듈의 기능을 구현하려면 여러 하위 기능이 필요하다
- 저수준 모듈은 하위 기능을 실제로 구현한 것
- 고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야 한다
    - 고수준 모듈이 저수준 모듈을 사용하면(의존하면), 구현 변경과 테스트가 어렵다는 문제가 발생
- DIP는 이 문제를 해결하기 위해 저수준 모듈이 고수준 모듈에 의존하도록 바꾼다 -> 추상화한 인터페이스
    - DIP를 적용하면 저수준 모듈이 고수준 모듈에 의존하게 된다 -> 의존 역전 원칙(Dependency Inversion Principle)
- 스프링과 같은 의존 주입을 지원하는 프레임워크를 사용하면 설정 코드를 수정해서 쉽게 구현체를 변경할 수 있다
- DIP를 항상 적용할 필요는 없다
    - 사용하는 구현 기술에 따라 완벽한 DIP를 적용하기보다는 구현 기술에 의존적인 코드를 도메인에 일부 포함하는 게 효과적일 때도 있다
    - 무조건 DIP를 적용하려고 시도하지 말고 DIP의 이점을 얻는 수준에서 적용 범위를 검토하자

## 2.4 도메인 영역의 주요 구성요소

- 도메인 영역의 주요 구성요소
    - 엔티티(Entity)
        - 고유의 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다
        - 주문(Order), 회원(Member), 상품(Product)과 같이 도메인의 고유한 개념을 표현한다
        - 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공
        - DB 테이블의 엔티티 != 도메인 모델의 엔티티
    - 밸류(Value)
        - 고유의 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 값을 표현할 때 사용된다
        - 배송지 주소를 표현하기 위한 주소(Address)나 구매 금액을 위한 금액(Money)와 같은 타입이 밸류 타입이다
        - 엔티티의 속성으로 사용할 뿐만 아니라 다른 밸류 타입의 속성으로도 사용할 수 있다
    - 애그리거트(Aggregate)
        - 애그리거트는 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것
        - ex) 주문과 관련된 Order 엔티티, OrderLine 밸류, Orderer 밸류 객체를 '주문' 애그리거트로 묶을 수 있다
    - 리포지터리
        - 도메인 모델의 영속성을 처리
        - DBMS 테이블에서 엔티티 객체를 로딩하거나 저장하는 기능을 제공
    - 도메인 서비스
        - 특정 엔티티에 속하지 않은 도메인 로직을 제공, 필드 변수가 없음
        - '할인 금액 계산'은 상품, 쿠폰, 회원 등급, 구매 금액 등 다양한 조건을 이용해서 구현하게 되는데, 이렇게 도메인 로직이 여러 엔티티와 밸류를 필요로 하면 도메인 서비스에서 로직을 구현

## 2.5 요청 처리 흐름

## 2.6 인프라스트럭처 개요

- 인프라스트럭처는 표현 영역, 응용 영역, 도메인 영역을 지원
- 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조 기능을 지원
- 도메인 영역과 응용 영역에서 인프라스트럭처의 기능을 직접 사용하는 것보다 이 두 영역에 정의한 인터페이스를 인프라스트럭처 영역에서 구현하는 것이 시스템을 더 유연하고 테스트하기 쉽게 만들어줌

## 2.7 모듈 구성

- 한 패키지에 가능하면 10 ~ 15개 미만으로 타입 개수를 유지, 이 개수가 넘어가면 패키지를 분리하자