## 도메인 서비스

**1. 여러 애그리거트가 필요한 기능**
- `결제 금액 계산` 로직과 같이 한 애그리거트로 기능을 구현할 수 없을 때가 존재

`실제 결제 금액 계산`
> - 상품 애그리거트 : 구매하는 상품의 가격이 필요하다. 또한 상품에 따라 배송비가 추가되기도 한다.
> - 주문 애그리거트 : 상품별로 구매 개수가 필요하다
> - 할인 쿠폰 애그리거트 : 쿠폰별로 지정한 할인 금액이나 비율에 따라 주문 총 금액을 할인한다.\
> 할인 쿠폰을 조건에 따라 중복 사용할 수 있다거나 지정한 카테고리의 상품에만 적용할 수 있다는\
> 제약 조건이 있다면 할인 계산이 복잡해진다.
> - 회원 애그리거트 : 회원 등급에 따라 추가 할인이 가능하다.

- 총 주문 금액을 계산하는 것 → `주문 애그리거트`가 할 수 있지만 **실제 결제 금액**은 아님
- 할인 쿠폰을 두 개 이상 적용할 수 있다면 단일 할인 쿠폰 애그리거트로는 총 결제 금액 계산 불가능
- 주문 애그리거트가 필요한 데이터를 모두 가지도록 한 뒤 할인 금액 게산 책임을 주문 애그리거트에 할당\
→ 추가 할인이 있을 경우 결제 금액 계산 책임이 주문 애그리거트에 있다는 이유로 주문 애그리거트의 코드를 수정해야 함\
→ 한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리거트에 구현 X

- 억지로 특정 애그리거트에 구현할 경우
> 1. 애그리거트는 자신의 책임 범위를 넘어서는 기능을 구현하기 때문에 코드가 길어짐
> 2. 외부에 대한 의존이 높아짐
> 3. 코드를 복잡하게 만들어 수정을 어렵게 만드는 요인이 됨
> 4. 애그리거트의 범위를 넘어서는 도메인의 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 됨

- `해결 방법` : 도메인 기능을 별도 서비스로 구현하는 것

---

**2. 도메인 서비스**
- 도메인 서비스를 사용하는 경우
> - 계산 로직 : 여러 애그리거트가 필요한 계산 로직이나, 한 애그리거트에 넣기에는 다소 복잡한 게산 로직
> - 외부시스템 연동이 필요한 도메인 로직 : 구현하기 위해 타 시스템을 사용해야 하는 도메인 로직

1. 계산 로직과 도메인 서비스
- 한 애그리거트에 넣기 애매한 도메인 개념은 `도메인 서비스`를 이용해서 도메인 개념을 명시적으로 드러내면 됨
- 응용 영역의 서비스가 응용 로직을 다룬다면 도메인 서비스는 도메인 로직을 다룸
- `도메인 영역`의 애그리거트나 밸류와 같은 구성요소와 도메인 서비스를 비교할 때 다른 점\
: 도메인 서비스는 상태 없이 로직만 구현
- 애그리거트 객체에 도메인 서비스를 전달하는 것은 `응용 서비스` 책임
- `도메인 서비스`는 도메인 로직을 수행하지 응용 로직을 수행하진 않음
- 트랜잭션 처리와 같은 로직은 응용 서비스에서 처리

2. 외부 시스템 연동과 도메인 서비스\
`ex) 설문 조사 시스템과 사용자 역할 관리 시스템`
- 두 시스템이 분리되어 있다고 할 때
- 설문 조사 시스템은 설문 조사를 생성할 때 사용자가 생성 권한을 가진 역할인지 확인하기 위해\
→ 역할 관리 시스템과 연동
- 시스템 간 연동은 HTTP API 호출로 이루어질 수 있지만\
설문 조사 도메인 입장에서는 사용자가 설문 조사 생성 권한을 가졌는지 확인하는 도메인 로직

3. 도메인 서비스의 패키지 위치
- `도메인 서비스`는 도메인 로직을 표현하므로 도메인 서비스의 위치는 다른 도메인 구성요소와 동일한 패키지에 위치
- 도메인 서비스의 개수가 많거나 엔티티나 밸류와 같은 다른 구성요소와 명시적으로 구분하고 싶다면\
→ `domain` 패키지 밑에 `domain.model`, `domain.service`, `domain.repository`와 같은 하위 패키지를 구분해도 됨

4. 도메인 서비스의 인터페이스와 클래스
- 도메인 서비스 로직이 고정되어 있지 않은 경우 **도메인 서비스 자체를 인터페이스로 구현**하고\
이를 구현한 클래스를 둘 수 있음
- 특히 도메인 로직을 외부 시스템이나 별도 엔진을 이용해서 구현할 때 인터페이스와 클래스 분리
- 도메인 서비스의 구현이 특정 구현 기술에 의존하거나 외부 시스템의 API를 실행한다면\
→ 도메인 영역의 도메인 서비스는 인터페이스로 추상화
- 이를 통해 도메인 영역이 특정 구현에 종속되는 것을 방지하고 테스트가 쉬워짐
