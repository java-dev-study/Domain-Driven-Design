## 6장. 응용 서비스와 표현 영역

<br>
<br>

### 6-1. 표현 영역과 응용 영역
***
표현 영역은 사용자의 요청을 해석한다   
실제 사용자가 원하는 기능을 제공하는 것은 응용 영역에 위차한 서비스다  
  
사용자와의 상호작용은 표현 영역이 처리하기 때문에 응용 서비스는 표현 영역에 의존하지 않는다. 응용 영역은 단지 기능 실행에 필요한 입력 값을 받고 실행 결과만 리턴하면 될 뿐이다

<br>
<br>

### 6-2. 응용 서비스의 역할
***
응용 서비스는 사용자(클라이언트)가 요청한 기능을 실행한다. 응용 서비스는 사용자의 요청을 처리하기 위해 리포지터리에서 도메인 객체를 가져와 사용한다.   
응용 서비스의 주요 역할은 도메인 객체를 사용해서 사용자의 요청을 처리하는 것이므로 표현(사용자) 영역 입장에서 보았을 때 응용 서비스는 도메인 영역과 표현 영역을 연결해주는 창구 역할을 한다.   
  
응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성이 높다. 응용 서비스가 도메인 로직을 일부 구현하면 코드 중복, 로직 분산 등 코드 품질에 안 좋은 영향을 줄 수 있다. 
  
  
응용 서비스는 트랜잭션 처리도 담당한다. 
 
    
- 도메인 로직 넣지 않기
  - 도메인 로직을 도메인 영역과 응용 서비스에 분산해서 구현하면 코드 품질에 문제가 발생
  -  코드의 응집성이 떨어짐
     -  도메인 데이터와 그 데이터를 조작하는 도메인 로직이 한 영역에 위치하지 않고 서로 다른 영에 위치한다는 것은 도메인 로직을 파악하기 위해 여러 영역을 분석해야한다는 것을 의미한다
  - 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아진다
  - 코드 변경을 어렵게 만든다
    - 도메인 로직을 도메인 영역에 모아서 코드 중복을 줄이고 응집도를 높여야 한다 


<br>
<br>


### 6-3. 응용 서비스의 구현
***
응용 서빗는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데 이는 디자인 패턴에서 파사드와 같은 역할을 한다    
   
- 응용 서비스의 크기
  - 한 응용 서비스 클래스에 회원 도메인의 모든 기능 구현하기
  - 구분하는 기능별로 응용 서비스 클래스를 따로 구현하기

  
각 클래스마다 구분되는 역할 선호 > 한 클래스가 여러 역할을 갖는 것  
한 도메인과 관련된 기능을 하나의 응용 서비 클래스에서 모두 구현하는 방식보다 구분되는 기능을 별도의 서비스 클래스로 구현하는 방식을 사용
 
  
  
- 응용 서비스의 인터페이스와 클래스
  - 필요한 몇 가지 상황
    - 구현 클래스가 여러 개
  - 표현 영역이 아닌 도메인 영역이나 응용 영역의 개발을 먼저 시작하면 응용 서비스 클래스가 먼저 만들어진다. 이렇게 되면 표현 영역의 단위 테스트를 위해 응용 서비스 클래스의 가짜 객체가 필요한데 이를 위해 인터페이스를 추가할 수도 있다
  - 이는 결과적으로 응용 서비스에 대한 필요성을 약화시킨다

   
- 메서드 파라미터와 값 리턴
  - 응용 서비스에서 애그리거트 자체를 리턴라면 코딩은 편할 수 있지만 도메인의 로직 실행을 응용 서비스와 표현 영역 두 곳에서 할 수 있게 된다
    - 기능 실행 로직을 응용 서비스와 표현 영역에 분산시켜 코드의 응집도를 낮추는 원인이 된다
  - 응용 서비스는 표현 영역에서 필요한 데이터만 리턴하는 것이 기능 실행 로직의 응집도를 높이는 확실한 방법

  
- 표현 영역에 의존하지 않기
  - 응용 서비스의 파라미터 타입을 결정할 때 주의할 점은 표현 영역과 관련된 타입을 사용하면 안 된다
  - 응용 서비스가 표현 영역의 기술을 사용하지 않도록 해야한다
    - 서비스 메서드의 파리미터와 리턴 타입으로 표현 영역의 구현 기술을 사용하지 않는 것
  
  
- 트랙재션 처리
  - 스프링에서 @Transactional 이 적용
  


<br>
<br>

### 6-4.표현 영역
***
- 표현 영역의 책임
  - 사용자가 시스템을 사용할 수 있는 흐름(화면)을 제공하고 제어한다
  - 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다
  - 사용자의 세션을 관리한다


<br>
<br>


### 6-5. 값 검증
***
값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있다  
원칙적으로 모든 값에 대한 검증은 응용 서비스에서 처리한다  

  
응용 서비스에서 각 값이 유효한지 확인할 목적으로 익셉션을 사용할 때의 문제점은 사용자에게 좋지 않은 경험을 제공한다는 것  
응용 서비스에서 값을 검사하는 시점에서 첫 번쨰 값이 올바르지 않아 익셉셔을 발생시키면 나머지 항목에 대해서는 값을 검사하지 않게 된다. 이러면 사용자는 첫 번째 값에 대한 에러 메시지만 보게 되고 나머지 항목에 대해서는 값이 올바른지를 알 수 없게 된다. 이는 사용자가 같은 폼에 값을 여러 번 입력하게 만든다.
  

__응용 서비스에서 에러코드를 모아 하나의 익셉션으로 발생시킨다__


- 표현 영역 : 필수 값, 값의 형식, 범위 등을 검증한다
- 응용 서비스 : 데이터의 존재 유무와 같은 논리적 오류를 검증한다

:bulb: 요즘은 가능하면 응용 서비스에서 필수 값 검증과 논리적인 검증을 모두 하는 편이다. 응용 서비스에서 필요한 값 검증을 모두 처리하면 프레임워크가 제공하는 검증 기능을 사용할 때마다 작성할 코드가 늘어나는 불편함이 있지만 반대로 응용 서비스의 완성도가 높아지는 이점이 있다.

<br>
<br>



### 6-6. 권한 검사
***
- 권한 검사 구역
  - 표현 영역
    - 인증된 사용자인지 아닌지
    - 서블릿 필터
    - 스프링 시큐리티는 필터를 이용해서 인증 정보를 생성하고 웹 접근을 제어
  - 응용 서비스
  - 도메인

  
  


<br>
<br>



### 6-7. 조회 전용 기능과 응용 서비스
***

<br>
<br>
