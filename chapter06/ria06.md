### Chaper06 응용 서비스와 표현 영역



#### 6.1 표현 영역과 응용 영역

- 사용자의 요구사항을 충족하는 소프트웨어를 만들기 위해서는 도메인 영역을 잘 구현해야 함
- 도메인 영역뿐만 아니라, 사용자와 도메인을 연결해 주는 매개체가 필요함
- 응용 영역과 표현 영역이 사용자와 도메인을 연결해 주는 매개체 역할을 함
- 표현 영역 : 사용자의 요청을 해석함
- 응용 영역 : 사용자가 원하는 기능을 제공함
- 표현 영역과 응용 서비스가 요구하는 형식으로 사용자 요청을 변환함
- 사용자와 상호작용은 표현 영역이 처리하기 때문에, 응용 서비스는 표현 영역에 의존하지 않음

#### 6.2 응용 서비스의 역할

- 응용 서비스

  - 리포지터리에서 도메인 객체를 가져와 사용자의 요청을 처리함

  - 도메인 객체 간의 흐름을 제어할 뿐, 도메인 로직을 구현하지 않음

  - 트랜잭션 처리를 담당함
    - 트랜잭션 범위에서 실행되지 않을 경우, 데이터의 일관성이 깨짐

  - 도메인 로직을 도메인 영역과 응용 서비스에 분산해서 구현할 경우 발생하는 문제점
    1. 코드의 응집성이 떨어짐
    2. 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아짐

​	=> 소프트웨어의 가치를 높이려면 도메인 로직을 도메인 영역에 모아서 코드 중복을 줄이고 응집도를 높여야 함

#### 6.3 응용 서비스의 구현

- 응용 서비스의 구현은 어렵지 않으나, 구현할 때 몇 가지 고려사항이 있음

  1. 응용 서비스의 크기

     - 한 응용 서비스 클래스에 회원 도메인의 모든 기능 구현하기
       - 한 클래스에 한 도메인과 관련된 기능을 구현할 경우, 각 기능에서 동일 로직에 대한 코드 중복을 제거할 수 있음
       - 그러나, 한 클래스의 크기(코드 줄 수)가 커져 코드를 이해하는 데 어려움이 있음
     - 구분되는 기능별로 응용 서비스 클래스를 따로 구현하기
       - 클래스 개수는 많아지지만, 코드 품질을 일정 수준으로 유지할 수 있음
       - 코드의 중복을 방지할 수 있음

     => 한 도메인과 구분되는 기능을 별도의 서비스 클래스로 구현하는 방식을 권장함

  2. 응용 서비스의 인터페이스와 클래스

     - 구현 클래스가 다수 존재하거나 런타임에 구현 객체를 교체해야할 때 인터페이스를 유용하게 사용할 수 있지만, 응용 서비스는 런타임에 교체하는 경우가 거의 없고 한 응용 서비스의 구현 클래스가 두 개인 경우도 드묾
     - 인터페이스와 클래스를 따로 구현하면 소스 파일만 많아지고 구현 클래스에 대한 간접 참조가 증가해서 전체 구조가 복잡해짐

     => 인터페이스가 명확하게 필요하기 전까지는 응용 서비스에 대한 인터페이스를 작성하는 것이 좋은 선택이 아닐수도 있음

  3. 메서드 파라미터와 값 리턴

     - 응용 서비스가 제공하는 메서드는 도메인을 이용해서 사용자가 요구한 기능을 실행하는 데 필요한 값을 파라미터로 전달받아야 하는데, 각 값을 개별 파라미터로 전달받을 수도 있고 별도의 데이터 클래스로 만들어 전달받을 수 있음

     ​	=> 응용 서비스에 데이터로 전달할 요청 파라미터가 두 개 이상 존재하면 데이터 전달을 위한 별도 클래스를 사용하는 것이 편리함

     - 응용 서비스의 결과를 표현 영역에서 사용해야 하면 응용 서비스 메서드의 결과로 필요한 데이터를 리턴함

     - 결과 데이터로 식별자를 리턴하거나 애그리거트 객체를 그대로 리턴할 수 있음

     				- 애그리거트 객체 자체를 리턴할 경우 기능 실행 로직을 응용 서비스와 표현 영역에 분산시켜 코드의 응집도를 낮추는 원인이 됨

     => 응용 서비스는 표현 영역에서 필요한 데이터만 리턴하는 것이 기능 실행 로직의 응집도를 높이는 확실한 방법임

  4. 표현 영역에 의존하지 않기

     - 응용 서비스의 파라미터 타입을 결정할 때 표현 영역과 관련된 타입을 사용하면 안됨
     - 응용 서비스가 표현 영역에 의존하게 될 경우, 표현 영역의 응집도가 깨짐

     => 서비스 메서드의 파라미터와 리턴 타입으로 표현 영역의 구현 기술을 사용하면 안됨

    		5. 트랜잭션 처리	
         - 트랜잭션을 관리하는 것은 응용 서비스의 중요한 역할로, 프레임워크가 제공하는 트랜잭션 기능 사용을 권장함
         - 프레임워크가 제공하는 규칙을 따르면 간단한 설정만으로 트랜잭션을 시작하여 커밋하고 익셉션이 발생하면 롤백할 수 있음

#### 6.4 표현 영역

- 표현 영역 책임 세 가지
  1. 사용자가 시스템을 사용할 수 있는 흐름(화면)을 제공하고 제어함
     - ex) 사용자는 표현 영역이 제공한 폼에 알맞은 값을 입력하고 다시 폼을 표현 영역에 전송
  2. 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공함
     - 사용자의 요청 데이터를 응용 서비스가 요구하는 형식으로 변환하고 응용 서비스의 결과를 사용자에게 응답할 수 있는 형식으로 변환함
  3. 사용자의 세션을 관리함
     - 웹은 쿠키나 서버 세션을 이용해서 사용자의 연결 상태를 관리함

#### 6.5 값 검증

- 값 검증은 표현, 응용 서비스 두 곳에서 모두 수행할 수 있는데 모든 값에 대한 검증은 응용 서비스에서 처리함

#### 6.6 권한 검사

- 권한 검사를 수행하는 영역 
  1. 표현 영역
     - 표현 영역에서 할 수 있는 기본적인 검사는 인증된 사용자인지 아닌지를 검사하는 것 - ex) 회원 정보 변경 기능
  2. 응용 서비스
     - URL만으로 접근 제어를 할 수 없는 경우, 응용 서비스의 메서드 단위로 권한 검사를 수행해야 함 ex) AOP
  3. 도메인
     - 응용 서비스의 메서드 수준에서 권한 검사를 할 수 없을 경우, 직접 권한 검사 로직을 구현해야 함

#### 6.7 조회 전용 기능과 응용 서비스

- 서비스에서 수행하는 추가적인 로직이 없고, 조회 기능만 있을 경우 표현 영역에서 바로 조회 전용 기능을 사용해도 문제가 없음

