
## 애그리거트와 트랜잭션
애그리거트의 일관성을 지키기 위해 추가적인 트랜잭션 처리 기법이 필요하다.
애그리거트에 대해 사용할 수 있는 대표적인 트랜잭션 처리 방식에는 선점 잠금과 비선점 잠금의 두 가지 방식이 있다.

## 선점 잠금
애그리거트를 구한 스레드가 애그리거트 사용이 끝날 때까지 다른 스레드가 해당 애그리거트를 수정하지 못하게 막는 방식.
선점 잠금은 보통 DBMS가 제공하는 행단위 잠금을 사용해서 구현한다.

### 선점 잠금과 교착상태
선점 잠금 기능을 사용할 때는 잠금 순서에 따른 교착상태(deadlock)가 발생하지 않도록 주의해야 한다.
교착 상태가 발생하지 않도록 하려면 잠금을 구할 때 최대 대기 시간을 지정해야 한다.

## 비선점 잠금
선점 잠금으로 모든 트랜잭션 충돌 문제가 해결되는 것은 아니다.
비선점 잠금은 동시에 접근하는 것을 막는 대신 변경한 데이터를 실제 DBMS에 반영하는 시점에 변경 가능 여부를 확인하는 방식.
구현을 위해서는 애그리거트에 버전으로 사용할 숫자 타입 프로퍼티를 추가해야 한다.

## 오프라인 선점 잠금
여러 트랜잭션에 걸쳐 동시 변경을 막는다.
