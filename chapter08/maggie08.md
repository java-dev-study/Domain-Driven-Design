### 8.1 애그리거트와 트랜잭션
- 애그리거트의 일관성을 유지하려면?

#### 8.1.1 선점 잠금 
- 트랜잭션 범위에서만 적용 ( JPA @Lock , find() .. )
- 교착상태 해소를 위한 최대 대기 시간 설정 필요 ( JPA @QueryHints )

#### 8.1.2 비선점 잠금 
- 추후 버전 충돌을 확인하여 적용
- 변경한 데이터를 실제 DBMS 에 반영하는시점에 변경 가능 여부 ( JPA @Version , Spring @Transactional ) 
- 응용 서비스에서 애그리거트 버전 일치 여부 확인 후, 기능 실행
- 표현 게층에도 알림, 후속 처리 가능
- 애그리거트 루트를 직접 변경하지 않더라도, 하위 애그리거트가 변경되었을 땐 강제로 버전증가가 필요 

#### 8.1.3 오프라인 선점 잠금
- 여러 트랜잭션의 동시 변경 제어 
- Ex. 수정 폼, 기능 
- 잠금 선점 시도
- 잠금 확인
- 잠금 해제 ( 잠금 미해제 시, 타 사용자 사용 불가. 반드시, 잠금 유효 시간 설정 필요 )
- 잠금 유효시간 연장 

예제 소스는 책에 보면 잘 나와있으니, 책을 볼 것. 
